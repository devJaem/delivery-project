datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  userId          Int          @id @default(autoincrement())
  nickName        String
  email           String       @unique
  password        String
  profilePicture  String?
  userType        UserType
  points          Int
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  restaurants     Restaurant[]
  orders          Order[]
  dibs            Dibs[]
  reviews         Review[]
  notifications   Notification[]
  refreshTokens   RefreshToken[]
}

model Restaurant {
  restaurantId   Int          @id @default(autoincrement())
  ownerId        Int
  name           String
  address        String
  category       String
  description    String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  owner          User         @relation(fields: [ownerId], references: [userId])
  menus          Menu[]
  orders         Order[]
  dibs           Dibs[]
  reviews        Review[]
  notifications  Notification[]
}

model Dibs {
  dibsId        Int          @id @default(autoincrement())
  customerId    Int
  restaurantId  Int
  islike        Boolean
  createdAt     DateTime     @default(now())
  customer      User         @relation(fields: [customerId], references: [userId])
  restaurant    Restaurant   @relation(fields: [restaurantId], references: [restaurantId])
}

model Menu {
  menuId        Int          @id @default(autoincrement())
  restaurantId  Int
  name          String
  imageURL      String
  price         Int
  description   String?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  restaurant    Restaurant   @relation(fields: [restaurantId], references: [restaurantId])
  options       Option[]
  orderItems    OrderItem[]
}

model Option {
  optionId      Int          @id @default(autoincrement())
  menuId        Int
  name          String
  description   String?
  menu          Menu         @relation(fields: [menuId], references: [menuId])
  selects       Select[]
}

model Select {
  selectId      Int          @id @default(autoincrement())
  optionId      Int
  name          String
  option        Option       @relation(fields: [optionId], references: [optionId])
  orderItems    OrderItem[]
}

model Order {
  orderId       Int          @id @default(autoincrement())
  customerId    Int
  restaurantId  Int
  totalPrice    Int
  orderStatus   OrderStatus
  createdAt     DateTime     @default(now())
  customer      User         @relation(fields: [customerId], references: [userId])
  restaurant    Restaurant   @relation(fields: [restaurantId], references: [restaurantId])
  orderItems    OrderItem[]
}

model OrderItem {
  orderItemId   Int          @id @default(autoincrement())
  orderId       Int
  menuId        Int
  selectId      Int
  quantity      Int
  price         Int
  createdAt     DateTime     @default(now())
  order         Order        @relation(fields: [orderId], references: [orderId])
  menu          Menu         @relation(fields: [menuId], references: [menuId])
  select        Select       @relation(fields: [selectId], references: [selectId])
}

model Review {
  reviewId      Int          @id @default(autoincrement())
  customerId    Int
  restaurantId  Int
  rating        Int
  comment       String
  reviewImage   String?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  customer      User         @relation(fields: [customerId], references: [userId])
  restaurant    Restaurant   @relation(fields: [restaurantId], references: [restaurantId])
}

model Notification {
  notificationId  Int        @id @default(autoincrement())
  userId          Int
  restaurantId    Int
  orderStatus     OrderStatus
  message         String
  isRead          Boolean
  createdAt       DateTime   @default(now())
  user            User       @relation(fields: [userId], references: [userId])
  restaurant      Restaurant @relation(fields: [restaurantId], references: [restaurantId])
}

model RefreshToken {
  refreshTokenId      Int       @id @default(autoincrement())
  userId       Int
  refreshToken String    @unique
  createdAt    DateTime  @default(now())
  user         User      @relation(fields: [userId], references: [userId])
}

enum UserType {
  Customer
  Owner
}

enum OrderStatus {
  Preparing
  Delivering
  Completed
}
